/**
 * @file MediaElement Playlist Feature (plugin).
 * @author Andrew Berezovsky <andrew.berezovsky@gmail.com>
 * Twitter handle: duozersk
 * @author Original author: Junaid Qadir Baloch <shekhanzai.baloch@gmail.com>
 * Twitter handle: jeykeu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
!function(a){a.extend(mejs.MepDefaults,{loopText:"Repeat On/Off",shuffleText:"Shuffle On/Off",nextText:"Next Track",prevText:"Previous Track",playlistText:"Show/Hide Playlist"}),a.extend(MediaElementPlayer.prototype,{buildloop:function(b,c,d,e){var f=this,g=a('<div class="mejs-button mejs-loop-button '+(b.options.loop?"mejs-loop-on":"mejs-loop-off")+'"><button type="button" aria-controls="'+b.id+'" title="'+b.options.loopText+'"></button></div>').appendTo(c).click(function(c){b.options.loop=!b.options.loop,a(e).trigger("mep-looptoggle",[b.options.loop]),b.options.loop?g.removeClass("mejs-loop-off").addClass("mejs-loop-on"):g.removeClass("mejs-loop-on").addClass("mejs-loop-off")});f.loopToggle=f.controls.find(".mejs-loop-button")},loopToggleClick:function(){var a=this;a.loopToggle.trigger("click")},buildshuffle:function(b,c,d,e){var f=this,g=a('<div class="mejs-button mejs-shuffle-button '+(b.options.shuffle?"mejs-shuffle-on":"mejs-shuffle-off")+'"><button type="button" aria-controls="'+b.id+'" title="'+b.options.shuffleText+'"></button></div>').appendTo(c).click(function(c){b.options.shuffle=!b.options.shuffle,a(e).trigger("mep-shuffletoggle",[b.options.shuffle]),b.options.shuffle?g.removeClass("mejs-shuffle-off").addClass("mejs-shuffle-on"):g.removeClass("mejs-shuffle-on").addClass("mejs-shuffle-off")});f.shuffleToggle=f.controls.find(".mejs-shuffle-button")},shuffleToggleClick:function(){var a=this;a.shuffleToggle.trigger("click")},buildprevtrack:function(b,c,d,e){var f=this;a('<div class="mejs-button mejs-prevtrack-button mejs-prevtrack"><button type="button" aria-controls="'+b.id+'" title="'+b.options.prevText+'"></button></div>').appendTo(c).click(function(c){a(e).trigger("mep-playprevtrack"),b.playPrevTrack()});f.prevTrack=f.controls.find(".mejs-prevtrack-button")},prevTrackClick:function(){var a=this;a.prevTrack.trigger("click")},buildnexttrack:function(b,c,d,e){var f=this;a('<div class="mejs-button mejs-nexttrack-button mejs-nexttrack"><button type="button" aria-controls="'+b.id+'" title="'+b.options.nextText+'"></button></div>').appendTo(c).click(function(c){a(e).trigger("mep-playnexttrack"),b.playNextTrack()});f.nextTrack=f.controls.find(".mejs-nexttrack-button")},nextTrackClick:function(){var a=this;a.nextTrack.trigger("click")},buildplaylist:function(b,c,d,e){var f=this,g=a('<div class="mejs-button mejs-playlist-button '+(b.options.playlist?"mejs-hide-playlist":"mejs-show-playlist")+'"><button type="button" aria-controls="'+b.id+'" title="'+b.options.playlistText+'"></button></div>').appendTo(c).click(function(c){b.options.playlist=!b.options.playlist,a(e).trigger("mep-playlisttoggle",[b.options.playlist]),b.options.playlist?(d.children(".mejs-playlist").show(),g.removeClass("mejs-show-playlist").addClass("mejs-hide-playlist")):(d.children(".mejs-playlist").hide(),g.removeClass("mejs-hide-playlist").addClass("mejs-show-playlist"))});f.playlistToggle=f.controls.find(".mejs-playlist-button")},playlistToggleClick:function(){var a=this;a.playlistToggle.trigger("click")},buildplaylistfeature:function(b,c,d,e){var f=a('<div class="mejs-playlist mejs-layer"><ul class="mejs"></ul></div>').appendTo(d);b.options.playlist||f.hide(),"bottom"==b.options.playlistposition?f.css("top",b.options.audioHeight+"px"):f.css("bottom",b.options.audioHeight+"px");var g=function(a){var b=a.split("/");return b.length>0?decodeURIComponent(b[b.length-1]):""},h=[];a("#"+b.id).find(".mejs-mediaelement source").each(function(b,c){if(""!=a.trim(this.src)){var d={};d.source=a.trim(this.src),""!=a.trim(this.title)?d.name=a.trim(this.title):d.name=g(d.source),h.push(d)}});for(var i in h)d.find(".mejs-playlist > ul").append('<li data-url="'+h[i].source+'" title="'+h[i].name+'">'+h[i].name+"</li>");d.find("li:first").addClass("current played"),d.find(".mejs-playlist > ul li").click(function(c){a(this).hasClass("current")?b.play():(a(this).addClass("played"),b.playTrack(a(this)))}),e.addEventListener("ended",function(a){b.playNextTrack()},!1)},playNextTrack:function(){var a=this,b=a.layers.find(".mejs-playlist > ul > li"),c=b.filter(".current"),d=b.not(".played");if(d.length<1&&(c.removeClass("played").siblings().removeClass("played"),d=b.not(".current")),a.options.shuffle)var e=Math.floor(Math.random()*d.length),f=d.eq(e);else{var f=c.next();f.length<1&&a.options.loop&&(f=c.siblings().first())}1==f.length&&(f.addClass("played"),a.playTrack(f))},playPrevTrack:function(){var a=this,b=a.layers.find(".mejs-playlist > ul > li"),c=b.filter(".current"),d=b.filter(".played").not(".current");if(d.length<1&&(c.removeClass("played"),d=b.not(".current")),a.options.shuffle)var e=Math.floor(Math.random()*d.length),f=d.eq(e);else{var f=c.prev();f.length<1&&a.options.loop&&(f=c.siblings().last())}1==f.length&&(c.removeClass("played"),a.playTrack(f))},playTrack:function(a){var b=this;b.pause(),b.setSrc(a.attr("data-url")),b.load(),b.play(),a.addClass("current").siblings().removeClass("current")},playTrackURL:function(a){var b=this,c=b.layers.find(".mejs-playlist > ul > li"),d=c.filter('[data-url="'+a+'"]');b.playTrack(d)}})}(mejs.$);